<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>CPRS Lab Formatter | VA Lab Data Analysis Tool</title>
    <meta name="description" content="Format CPRS lab data from the VA with automatic calculations for anion gap, corrected calcium, ABG analysis, MELD scores and more. A tool for healthcare professionals.">
    <meta name="author" content="Matthew Segar, MD">
    <meta name="keywords" content="CPRS, lab data, VA healthcare, lab formatter, medical calculations, MELD calculator, ABG analysis, lab formatting tool">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="CPRS Lab Formatter | VA Lab Data Analysis Tool">
    <meta property="og:description" content="Format CPRS lab data from the VA with automatic calculations for medical professionals.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://segar.me/valabformatter">
    
    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="CPRS Lab Formatter | VA Lab Data Analysis Tool">
    <meta name="twitter:description" content="Format CPRS lab data from the VA with automatic calculations for anion gap, corrected calcium, and more.">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N9RJDGM699"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-N9RJDGM699');
    </script>
    
    <!-- Schema.org markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "CPRS Lab Formatter",
      "description": "A tool for formatting and analyzing CPRS lab data from the VA healthcare system",
      "applicationCategory": "HealthcareApplication",
      "operatingSystem": "All",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "author": {
        "@type": "Person",
        "name": "Matthew Segar, MD"
      }
    }
    </script>
    
    <!-- Stylesheets -->
    <style>
        :root {
            --primary-color: #0099cc;
            --secondary-color: #007299;
            --bg-dark: #1e1e1e;
            --bg-darker: #121212;
            --text-light: #f5f5f5;
            --text-muted: #aaaaaa;
            --border-color: #333333;
            --success-color: #28a745;
            --warning-color: #ffc107;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-light);
            background-color: var(--bg-dark);
            padding: 0;
            margin: 0;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        header {
            background-color: var(--bg-darker);
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .home-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .home-button:hover {
            background-color: var(--secondary-color);
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .formatter-panel {
            flex: 1;
            min-width: 300px;
            padding: 20px;
        }
        
        .info-panel {
            flex: 0 0 300px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            margin-left: 20px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .info-panel {
                margin-left: 0;
                margin-top: 20px;
            }
        }
        
        h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
        }
        
        h3 {
            color: var(--text-light);
            margin: 15px 0 10px;
        }
        
        ul {
            list-style-position: inside;
            margin-bottom: 15px;
        }
        
        li {
            margin-bottom: 5px;
            color: var(--text-muted);
        }
        
        textarea {
            width: 100%;
            min-height: 400px;
            border: 1px solid var(--border-color);
            padding: 10px;
            font-family: 'Courier New', monospace;
            background-color: var(--bg-darker);
            color: var(--text-light);
            border-radius: 5px;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .checkbox-group {
            display: flex;
            gap: 15px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            user-select: none;
            cursor: pointer;
        }
        
        .checkbox-label input {
            margin-right: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .primary-button {
            background-color: var(--primary-color);
            color: white;
        }
        
        .primary-button:hover {
            background-color: var(--secondary-color);
        }
        
        .secondary-button {
            background-color: var(--border-color);
            color: white;
        }
        
        .secondary-button:hover {
            background-color: #555555;
        }
        
        footer {
            margin-top: 40px;
            padding: 20px 0;
            background-color: var(--bg-darker);
            text-align: center;
            color: var(--text-muted);
            font-size: 14px;
        }
        
        /* Accordion Styles */
        .accordion {
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .accordion-header {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .accordion-header:hover {
            background-color: rgba(0, 0, 0, 0.3);
        }
        
        .accordion-header h3 {
            margin: 0;
            font-size: 16px;
        }
        
        .accordion-icon {
            transition: transform 0.3s;
        }
        
        .accordion-content {
            background-color: rgba(0, 0, 0, 0.1);
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s;
        }
        
        .accordion-content.active {
            padding: 15px;
            max-height: 1000px;
        }
        
        .accordion-content p {
            margin-bottom: 10px;
        }
        
        .steps {
            margin-left: 20px;
        }
        
        .step {
            margin-bottom: 15px;
        }
        
        .step-number {
            display: inline-block;
            width: 24px;
            height: 24px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 10px;
        }
        
        /* Debug toggle button - hidden by default */
        .debug-toggle {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            font-size: 12px;
            padding: 5px;
            cursor: pointer;
            opacity: 0.5;
        }
        
        .debug-toggle:hover {
            opacity: 1;
        }
    </style>
    
    <!-- JavaScript -->
	<script src="js/cprs-utils.js"></script>
    <script src="js/cprs-formatter.js"></script>
</head>

<body>
    <header>
        <div class="container header-content">
            <div>
                <h1>CPRS Lab Formatter</h1>
                <p>Visualize VA lab results easily</p>
            </div>
            <button class="home-button" onclick="location.href='https://segar.me';">Home</button>
        </div>
    </header>
    
    <div class="container">
        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <h3>How to Use This Tool</h3>
                <span class="accordion-icon">▼</span>
            </div>
            <div class="accordion-content">
                <p>Follow these steps to format your VA CPRS lab data:</p>
                
                <div class="steps">
                    <div class="step">
                        <span class="step-number">1</span>
                        <strong>Access CPRS:</strong> Log into your VA CPRS system.
                    </div>
                    
                    <div class="step">
                        <span class="step-number">2</span>
                        <strong>Navigate to Labs:</strong> Click on the "Labs" tab at the bottom of the screen.
                    </div>
                    
                    <div class="step">
                        <span class="step-number">3</span>
                        <strong>View Lab Results:</strong> On the left side, you'll see the "Lab Results" pane.
                    </div>
                    
                    <div class="step">
                        <span class="step-number">4</span>
                        <strong>Select View:</strong> Click "All Tests by Date" to see the chronological list of labs.
                    </div>
                    
                    <div class="step">
                        <span class="step-number">5</span>
                        <strong>Choose Date Range:</strong> Select the desired date range for the labs you want to format.
                    </div>
                    
                    <div class="step">
                        <span class="step-number">6</span>
                        <strong>Copy Lab Data:</strong> Press Ctrl+A to select all text in the lab results pane, then press Ctrl+C to copy.
                    </div>
                    
                    <div class="step">
                        <span class="step-number">7</span>
                        <strong>Paste into Formatter:</strong> Paste the copied text into the text area below using Ctrl+V.
                    </div>
                    
                    <div class="step">
                        <span class="step-number">8</span>
                        <strong>Format the Data:</strong> Click the "Format Labs" button to transform the data into organized, readable formats.
                    </div>
                </div>
                
                <p><strong>Note:</strong> This tool works with lab data from the VA's CPRS system. It automatically formats CBC, BMP, CMP, ABG, and other common lab panels while performing calculations like anion gap and corrected calcium.</p>
            </div>
        </div>
        
        <div class="main-content">
            <div class="formatter-panel">
                <h2>Lab Data Formatter</h2>
                
                <form name="data1">
                    <textarea name="edtData" aria-label="Paste your CPRS lab data here" placeholder="Paste your CPRS lab data here..."></textarea>
                    
                    <div class="controls">
                        <div class="checkbox-group">
                            <label class="checkbox-label" for="chkMELD">
                                <input type="checkbox" name="chkMELD" id="chkMELD">
                                Calculate MELD Score
                            </label>
                            
                            <label class="checkbox-label" for="chkABG">
                                <input type="checkbox" name="chkABG" id="chkABG" checked>
                                Analyze ABG
                            </label>
                        </div>
                        
                        <div class="button-group">
                            <button type="button" id="formatButton" class="primary-button" aria-label="Format lab data" onclick="formatLabData()">Format Labs</button>
                            <button type="reset" id="resetButton" class="secondary-button" aria-label="Clear form">Clear</button>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="info-panel">
                <h2>Features</h2>
                
                <h3>Automatic Calculations</h3>
                <ul>
                    <li>Sodium corrected for glucose</li>
                    <li>Calcium corrected for albumin</li>
                    <li>Anion gap corrected for albumin</li>
                    <li>FENa calculation</li>
                    <li>FEUrea calculation</li>
                    <li>ABG analysis (mixed disorders, A-a gradient)</li>
                    <li>MELD score calculation</li>
                </ul>
                
                <h3>Special Formatting</h3>
                <ul>
                    <li>CBC - Complete Blood Count</li>
                    <li>BMP - Basic Metabolic Panel</li>
                    <li>CMP - Comprehensive Metabolic Panel</li>
                    <li>ABG - Arterial Blood Gas</li>
                    <li>UA - Urinalysis</li>
                </ul>
                
                <h3>About This Tool</h3>
                <p style="color: var(--text-muted); font-size: 14px; margin-top: 10px;">
                    CPRS Lab Formatter was designed to help healthcare professionals in the VA system quickly interpret lab data. It transforms complex lab reports into easy-to-read formats with automatic clinical calculations.
                </p>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            CPRS Lab Formatter &copy; Matt Segar | Updated March 2025
        </div>
    </footer>
    
    <!-- Debug toggle button (hidden in production) -->
    <button class="debug-toggle" onclick="toggleDebug()">Debug Mode</button>
    
    <script>
        // Accordion functionality
        function toggleAccordion(element) {
            const content = element.nextElementSibling;
            const icon = element.querySelector('.accordion-icon');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.textContent = '▼';
            } else {
                content.classList.add('active');
                icon.textContent = '▲';
            }
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Initial accordion state (closed by default)
            const accordionHeaders = document.querySelectorAll('.accordion-header');
            accordionHeaders.forEach(header => {
                const content = header.nextElementSibling;
                const icon = header.querySelector('.accordion-icon');
                content.classList.remove('active');
                icon.textContent = '▼';
            });
        });
    </script>
</body>
</html>