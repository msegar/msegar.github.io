<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migrating Static Sites to Dokploy with Traefik and Let's Encrypt - Matt Segar</title>

    <!-- Favicon -->
    <link rel="icon" href="assets/favicon_io/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="assets/favicon_io/favicon.ico" type="image/x-icon">
    
    <!-- Primary Meta Tags -->
    <meta name="description" content="A practical guide to hosting static sites on Dokploy, including React SPAs, SSL certificates, and the networking gotchas that will save you hours.">
    <meta name="author" content="Matt Segar">
    <meta name="keywords" content="traefik, dokploy, cloudflare, your, static">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://segar.me/blog/posts/dokploy.html">
    <meta property="og:title" content="Migrating Static Sites to Dokploy with Traefik and Let's Encrypt - Matt Segar">
    <meta property="og:description" content="A practical guide to hosting static sites on Dokploy, including React SPAs, SSL certificates, and the networking gotchas that will save you hours.">
    <meta property="og:image" content="../assets/images/dokploy.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://segar.me/blog/posts/dokploy.html">
    <meta property="twitter:title" content="Migrating Static Sites to Dokploy with Traefik and Let's Encrypt - Matt Segar">
    <meta property="twitter:description" content="A practical guide to hosting static sites on Dokploy, including React SPAs, SSL certificates, and the networking gotchas that will save you hours.">
    <meta property="twitter:image" content="../assets/images/dokploy.png">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://segar.me/blog/posts/dokploy.html">
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": "Migrating Static Sites to Dokploy with Traefik and Let's Encrypt",
      "description": "A practical guide to hosting static sites on Dokploy, including React SPAs, SSL certificates, and the networking gotchas that will save you hours.",
      "image": "../assets/images/dokploy.png",
      "author": {
        "@type": "Person",
        "name": "Matt Segar"
      },
      "publisher": {
        "@type": "Person",
        "name": "Matt Segar",
        "logo": {
          "@type": "ImageObject",
          "url": "https://segar.me/assets/images/logo_name.webp"
        }
      },
      "datePublished": "2026-01-21T00:00:00.000Z",
      "dateModified": "2026-01-21T00:00:00.000Z",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://segar.me/blog/posts/dokploy.html"
      },
      "keywords": "traefik, dokploy, cloudflare, your, static"
    }
    </script>
    
    <link rel="stylesheet" href="../../assets/css/normalize.css">
    <link rel="stylesheet" href="../../assets/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* Blog post specific styles */
        .post-header {
            margin-bottom: 40px;
        }
        
        .post-title {
            font-size: 2.4rem;
            margin-bottom: 10px;
        }
        
        .post-meta {
            font-size: 0.9rem;
            color: var(--light-text);
            margin-bottom: 20px;
        }
        
        .post-content {
            font-size: 1.1rem;
            line-height: 1.8;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .post-content h2 {
            margin-top: 40px;
            margin-bottom: 20px;
        }
        
        .post-content p {
            margin-bottom: 20px;
        }
        
        .post-content img {
            max-width: 100%;
            height: auto;
            margin: 30px 0;
            border-radius: 5px;
        }
        
        .post-content pre {
            background-color: var(--light-background);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        .post-content code {
            font-family: monospace;
            background-color: var(--light-background);
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .post-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
        }
        
        .post-nav a {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            text-decoration: none;
        }

    </style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N9RJDGM699"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-N9RJDGM699');
    </script>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <a href="index.html" class="logo-link">
                    <img src="../../assets/images/logo_color.webp" alt="Matt Segar Logo" class="logo-image light-logo" width="40" height="40">
                    <img src="../../assets/images/logo_dark.webp" alt="Matt Segar Logo" class="logo-image dark-logo" width="40" height="40">
                    <h1>Matt Segar</h1>
                </a>
            </div>
            <nav>
                <ul>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../../cv.html">CV</a></li>
                    <li><a href="../index.html" class="active">Blog</a></li>
                    <li class="dropdown">
                        <a class="nav-link">Innovations</a>
                        <div class="dropdown-content">
                            <a href="../../book.html">ML Book</a>
                            <a href="../../job-search-book.html">Physician's Job Search Playbook</a>
                            <a href="../../valabformatter/index.html">CPRS Lab Formatter</a>
                        </div>
                    </li>
                    <li class="theme-toggle">
                        <button id="theme-toggle-btn" aria-label="Toggle dark mode">
                            <span class="light-icon">‚òÄÔ∏è</span>
                            <span class="dark-icon">üåô</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="container">
            <article class="post-content">
                <header class="post-header">
                    <h1 class="post-title">Migrating Static Sites to Dokploy with Traefik and Let's Encrypt</h1>
                    <div class="post-meta">
                        <time datetime="2026-01-21T00:00:00.000Z">January 20, 2026</time>
                    </div>
                </header>
                
                <div class="post-body">
                    <p>I recently migrated two static sites from nginx on bare metal to Dokploy with Traefik reverse proxy. What should have been a 15-minute job turned into several hours of debugging Docker networking, SSL certificate resolvers, and load balancer configurations. Here&#39;s what I learned so you don&#39;t have to.</p>
<h2 id="why-dokploy">Why Dokploy?</h2>
<p>Dokploy is a self-hosted PaaS (think Heroku/Vercel for your own VPS) that uses Docker Compose under the hood with Traefik as the reverse proxy. It handles:</p>
<ul>
<li><strong>Automatic SSL</strong> via Let&#39;s Encrypt</li>
<li><strong>Zero-downtime deployments</strong></li>
<li><strong>Built-in monitoring</strong></li>
<li><strong>Simple UI</strong> for managing services</li>
</ul>
<p>I had two sites running on nginx with Cloudflare SSL certificates:</p>
<ul>
<li><code>cvriskscores.com</code> - A basic static HTML site</li>
<li><code>prolegohealth.com</code> - A React SPA with client-side routing</li>
</ul>
<p>Both were behind Cloudflare with Authenticated Origin Pulls enabled, which added complexity to the migration.</p>
<h2 id="the-basic-setup">The Basic Setup</h2>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>A VPS with Dokploy installed</li>
<li>Static files in <code>/var/www/yoursite.com/html</code></li>
<li>Domain pointing to your server</li>
<li>Cloudflare (optional, but common)</li>
</ul>
<h3 id="step-1-disable-your-existing-nginx">Step 1: Disable Your Existing nginx</h3>
<pre><code class="language-bash">sudo systemctl stop nginx
sudo systemctl disable nginx
</code></pre>
<p>Dokploy&#39;s Traefik will bind to ports 80 and 443, so nginx needs to be out of the way.</p>
<h3 id="step-2-create-a-docker-compose-file">Step 2: Create a Docker Compose File</h3>
<p>For a basic static site, create this in Dokploy&#39;s UI under &quot;Services&quot; ‚Üí &quot;Compose&quot;:</p>
<pre><code class="language-yaml">version: &#39;3.8&#39;
services:
  mysite:
    image: nginx:alpine
    volumes:
      - /var/www/yoursite.com/html:/usr/share/nginx/html:ro
    networks:
      - dokploy-network
    labels:
      - &quot;traefik.enable=true&quot;
      - &quot;traefik.docker.network=dokploy-network&quot;
      - &quot;traefik.http.routers.mysite.rule=Host(`yoursite.com`) || Host(`www.yoursite.com`)&quot;
      - &quot;traefik.http.routers.mysite.entrypoints=websecure&quot;
      - &quot;traefik.http.routers.mysite.tls=true&quot;
      - &quot;traefik.http.routers.mysite.tls.certresolver=letsencrypt&quot;
      - &quot;traefik.http.services.mysite.loadbalancer.server.port=80&quot;
      # HTTP to HTTPS redirect
      - &quot;traefik.http.middlewares.mysite-redirect.redirectscheme.scheme=https&quot;
      - &quot;traefik.http.routers.mysite-http.rule=Host(`yoursite.com`) || Host(`www.yoursite.com`)&quot;
      - &quot;traefik.http.routers.mysite-http.entrypoints=web&quot;
      - &quot;traefik.http.routers.mysite-http.middlewares=mysite-redirect&quot;

networks:
  dokploy-network:
    external: true
</code></pre>
<h3 id="step-3-deploy">Step 3: Deploy</h3>
<p>Click &quot;Deploy&quot; in Dokploy. The service should start in 10-20 seconds.</p>
<h2 id="the-gotchas-that-cost-me-hours">The Gotchas That Cost Me Hours</h2>
<h3 id="1-the-load-balancer-port-gateway-timeout">1. The Load Balancer Port (Gateway Timeout)</h3>
<p><strong>The error:</strong></p>
<pre><code>HTTP/2 504 Gateway Timeout
</code></pre>
<p><strong>The problem:</strong> Traefik didn&#39;t know which port to forward traffic to inside the container.</p>
<p><strong>The fix:</strong> Add this label:</p>
<pre><code class="language-yaml">- &quot;traefik.http.services.mysite.loadbalancer.server.port=80&quot;
</code></pre>
<p>Without this, Traefik attempts to auto-detect the port. If your container exposes multiple ports or Traefik guesses wrong, you get timeouts.</p>
<h3 id="2-docker-network-isolation">2. Docker Network Isolation</h3>
<p><strong>The error:</strong></p>
<pre><code>wget: bad address &#39;mysite-container-name&#39;
</code></pre>
<p><strong>The problem:</strong> By default, Docker Compose creates an isolated network for each service. Traefik runs on <code>dokploy-network</code>, but your service runs on <code>myservice_default</code>. They can&#39;t talk to each other.</p>
<p><strong>The fix:</strong> Two labels are required:</p>
<pre><code class="language-yaml">networks:
  - dokploy-network

labels:
  - &quot;traefik.docker.network=dokploy-network&quot;  # Tell Traefik which network to use
</code></pre>
<p>The first connects your container to the network. The second tells Traefik to route via that network. <strong>Both are necessary.</strong></p>
<h3 id="3-react-spa-routing-404s-on-refresh">3. React SPA Routing (404s on Refresh)</h3>
<p><strong>The problem:</strong> Refreshing <code>/about</code> in a React app returns a 404 because nginx looks for a file called <code>about</code>, which doesn&#39;t exist.</p>
<p><strong>The fix:</strong> Create an nginx config that serves <code>index.html</code> for all routes:</p>
<p><code>/var/www/yoursite.com/nginx.conf</code>:</p>
<pre><code class="language-nginx">server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # SPA routing - serve index.html for all routes
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Cache static assets
    location /assets {
        expires 1y;
        add_header Cache-Control &quot;public, immutable&quot;;
    }

    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot|webp)$ {
        expires 1y;
        add_header Cache-Control &quot;public, immutable&quot;;
    }
}
</code></pre>
<p>Then mount it in your compose file:</p>
<pre><code class="language-yaml">volumes:
  - /var/www/yoursite.com/html:/usr/share/nginx/html:ro
  - /var/www/yoursite.com/nginx.conf:/etc/nginx/conf.d/default.conf:ro
</code></pre>
<h3 id="4-cloudflare-authenticated-origin-pulls">4. Cloudflare Authenticated Origin Pulls</h3>
<p><strong>The problem:</strong> If you had Authenticated Origin Pulls enabled with your old nginx setup, it won&#39;t work with Let&#39;s Encrypt certificates.</p>
<p><strong>The fix:</strong> Go to Cloudflare ‚Üí SSL/TLS ‚Üí Origin Server and <strong>disable</strong> Authenticated Origin Pulls. Let&#39;s Encrypt certificates are trusted by Cloudflare&#39;s &quot;Full (strict)&quot; mode without additional client certificates.</p>
<p>Alternatively, keep your Cloudflare origin certificates and configure Traefik to use them (more complex).</p>
<h3 id="5-lets-encrypt-certificate-location">5. Let&#39;s Encrypt Certificate Location</h3>
<p><strong>The problem:</strong> Certificates weren&#39;t being generated.</p>
<p><strong>The check:</strong> Verify Let&#39;s Encrypt is configured in Traefik:</p>
<pre><code class="language-bash">cat /etc/dokploy/traefik/traefik.yml | grep -A 10 certificatesResolvers
</code></pre>
<p>Expected output:</p>
<pre><code class="language-yaml">certificatesResolvers:
  letsencrypt:
    acme:
      email: your@email.com
      storage: /etc/dokploy/traefik/dynamic/acme.json
      httpChallenge:
        entryPoint: web
</code></pre>
<p>Certificates are stored in <code>/etc/dokploy/traefik/dynamic/acme.json</code>. You can inspect them:</p>
<pre><code class="language-bash">cat /etc/dokploy/traefik/dynamic/acme.json
</code></pre>
<p>If the file is empty or doesn&#39;t exist, check Traefik logs:</p>
<pre><code class="language-bash">docker logs $(docker ps | grep traefik | awk &#39;{print $1}&#39;) --tail 100
</code></pre>
<h3 id="6-old-containers-causing-conflicts">6. Old Containers Causing Conflicts</h3>
<p><strong>The problem:</strong> Deploying and redeploying in Dokploy can leave behind stopped containers that still have Traefik labels, causing routing conflicts.</p>
<p><strong>The fix:</strong> Clean up old containers:</p>
<pre><code class="language-bash">docker ps -a | grep your-service-name
docker rm $(docker ps -a | grep your-service-name-old | awk &#39;{print $1}&#39;)
</code></pre>
<p>Or configure Dokploy to auto-remove stopped containers.</p>
<h2 id="cloudflare-configuration">Cloudflare Configuration</h2>
<p>If you&#39;re using Cloudflare:</p>
<ol>
<li><p><strong>DNS Settings:</strong></p>
<ul>
<li>A record: <code>yoursite.com</code> ‚Üí Your VPS IP</li>
<li>A record: <code>www.yoursite.com</code> ‚Üí Your VPS IP</li>
<li>Proxy status: <strong>ON</strong> (orange cloud)</li>
</ul>
</li>
<li><p><strong>SSL/TLS Settings:</strong></p>
<ul>
<li>Mode: <strong>Full (strict)</strong></li>
<li>Authenticated Origin Pulls: <strong>OFF</strong></li>
<li>Always Use HTTPS: <strong>ON</strong></li>
</ul>
</li>
<li><p><strong>Edge Certificates:</strong></p>
<ul>
<li>Should auto-provision via Cloudflare Universal SSL</li>
<li>No action needed</li>
</ul>
</li>
</ol>
<h2 id="performance-optimizations">Performance Optimizations</h2>
<h3 id="enable-gzip-compression">Enable Gzip Compression</h3>
<p>Add to your nginx config:</p>
<pre><code class="language-nginx">gzip on;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
gzip_min_length 1000;
</code></pre>
<h3 id="asset-caching">Asset Caching</h3>
<p>The config above already includes cache headers for static assets. For a production setup, consider using CloudFlare&#39;s caching:</p>
<ul>
<li>Go to Caching ‚Üí Configuration</li>
<li>Set Browser Cache TTL to 4 hours or more</li>
<li>Enable Auto Minify for JS/CSS/HTML</li>
</ul>
<h2 id="debugging-checklist">Debugging Checklist</h2>
<p>When something doesn&#39;t work:</p>
<ol>
<li><strong>Is the container running?</strong></li>
</ol>
<pre><code class="language-bash">   docker ps | grep your-service
</code></pre>
<ol start="2">
<li><strong>Can the container be accessed locally?</strong></li>
</ol>
<pre><code class="language-bash">   curl -I http://localhost -H &quot;Host: yoursite.com&quot;
</code></pre>
<ol start="3">
<li><strong>Is the container on the right network?</strong></li>
</ol>
<pre><code class="language-bash">   docker inspect &lt;container-id&gt; | grep -A 10 Networks
</code></pre>
<p>   Should show <code>dokploy-network</code>.</p>
<ol start="4">
<li><strong>Are Traefik labels correct?</strong></li>
</ol>
<pre><code class="language-bash">   docker inspect &lt;container-id&gt; | grep -A 30 Labels
</code></pre>
<ol start="5">
<li><strong>Check Traefik logs:</strong></li>
</ol>
<pre><code class="language-bash">   docker logs $(docker ps | grep traefik | awk &#39;{print $1}&#39;) --tail 50
</code></pre>
<ol start="6">
<li><strong>Test SSL certificate:</strong></li>
</ol>
<pre><code class="language-bash">   curl -Ik https://yoursite.com
</code></pre>
<h2 id="the-complete-working-config">The Complete Working Config</h2>
<p>Here&#39;s the final compose file for the React SPA with all gotchas fixed:</p>
<pre><code class="language-yaml">version: &#39;3.8&#39;
services:
  prolegohealth:
    image: nginx:alpine
    volumes:
      - /var/www/prolegohealth.com/html:/usr/share/nginx/html:ro
      - /var/www/prolegohealth.com/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - dokploy-network
    labels:
      - &quot;traefik.enable=true&quot;
      - &quot;traefik.docker.network=dokploy-network&quot;
      - &quot;traefik.http.routers.prolegohealth.rule=Host(`prolegohealth.com`) || Host(`www.prolegohealth.com`)&quot;
      - &quot;traefik.http.routers.prolegohealth.entrypoints=websecure&quot;
      - &quot;traefik.http.routers.prolegohealth.tls=true&quot;
      - &quot;traefik.http.routers.prolegohealth.tls.certresolver=letsencrypt&quot;
      - &quot;traefik.http.services.prolegohealth.loadbalancer.server.port=80&quot;
      - &quot;traefik.http.middlewares.prolegohealth-redirect.redirectscheme.scheme=https&quot;
      - &quot;traefik.http.routers.prolegohealth-http.rule=Host(`prolegohealth.com`) || Host(`www.prolegohealth.com`)&quot;
      - &quot;traefik.http.routers.prolegohealth-http.entrypoints=web&quot;
      - &quot;traefik.http.routers.prolegohealth-http.middlewares=prolegohealth-redirect&quot;

networks:
  dokploy-network:
    external: true
</code></pre>
<h2 id="final-thoughts">Final Thoughts</h2>
<p>Migrating to Dokploy simplified my deployment workflow, but the learning curve around Traefik labels and Docker networking was steeper than expected. The key lessons:</p>
<ol>
<li><strong>Always specify the load balancer port</strong> - don&#39;t rely on auto-detection</li>
<li><strong>Network configuration is critical</strong> - both the <code>networks:</code> block and the <code>traefik.docker.network</code> label</li>
<li><strong>React SPAs need special nginx configs</strong> - <code>try_files</code> is essential</li>
<li><strong>Disable Cloudflare Authenticated Origin Pulls</strong> unless you&#39;re using Cloudflare Origin Certificates</li>
<li><strong>Check Traefik logs early</strong> - they&#39;ll show routing conflicts and certificate issues</li>
</ol>
<p>The whole migration took a few hours with debugging, but now deployments are trivial. No more manual nginx config edits, no certificate renewals to worry about, and a clean UI for managing services.</p>
<hr>
<p><em>Questions? Hit a different gotcha? Let me know - I&#39;m happy to update this guide.</em></p>

                </div>
                
                <div class="post-nav">
                    <a href="../index.html">‚Üê Back to Blog</a>
                </div>
            </article>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; <script>document.write(new Date().getFullYear())</script> Dr. Matt Segar. All rights reserved.</p>
            <p><a href="sitemap.xml">Sitemap</a> | <a href="privacy-policy.html">Privacy Policy</a></p>
        </div>
    </footer>

    <!-- External JS file for theme toggle -->
    <script src="../../assets/js/theme-toggle.js"></script>
</body>
</html>